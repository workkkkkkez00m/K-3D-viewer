<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>電梯監控系統</title>
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/apple-touch-icon.png">
    <link rel="shortcut icon" href="../assets/favicon.ico">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <style>
        /* --- 基礎樣式 --- */
        body { margin: 0; font-family: 'Microsoft JhengHei', 'Heiti TC', sans-serif; overflow: hidden; background-color: #0d1117; color: #c9d1d9; }

        /* --- 框架 UI 樣式  --- */
        #top-banner {
            position: relative; top: 0; left: 0; width: 100%;
            background-color: rgba(0, 0, 0, 0.7); color: white;
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 20px; box-sizing: border-box; z-index: 20;
        }
        #project-title { margin: 0; font-size: 22px; font-weight: 500; margin-left: 15px; }
        #datetime-container { font-size: 16px; }
        #menu-toggle-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 0 10px; }
        #sidebar-menu { position: fixed; top: 0; left: -300px; width: 280px; height: 100%; background-color: #2c3e50; padding: 20px; box-sizing: border-box; z-index: 1000; transition: left 0.3s ease-in-out; }
        #sidebar-menu.open { left: 0; }
        #sidebar-menu h2 { color: white; margin-top: 50px; border-bottom: 1px solid #465a70; padding-bottom: 10px; }
        #sidebar-menu ul { list-style: none; padding: 0; margin-top: 20px;}
        #sidebar-menu li a { display: block; color: #ecf0f1; text-decoration: none; padding: 15px 10px; border-radius: 4px; transition: background-color 0.2s; }
        #sidebar-menu li a:hover { background-color: #34495e; }
        #close-menu-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; color: white; font-size: 30px; font-weight: bold; line-height: 1; cursor: pointer; }
        #sidebar-menu .system-category > a { font-weight: bold; background-color: #1bdbed; color: white; }
        #sidebar-menu .system-category > a::after { content: '▼'; float: right; transition: transform 0.3s; }
        #sidebar-menu .system-category.active > a::after { transform: rotate(180deg); }
        .floor-submenu { list-style: none; padding-left: 20px; max-height: 0; overflow: hidden; transition: max-height 0.4s ease-in-out; }
        #back-to-home-btn { margin-top: 20px; padding-top: 20px !important; border-top: 1px solid #465a70; font-weight: bold; color: #1bdbed !important; }
        #back-to-home-btn:hover { background-color: #34495e !important; color: #1fecff !important; }
        /* 為能源管理和電梯監控系統按鈕添加適當間距 */
        #sidebar-menu li a[href*="energy"] {
            margin-bottom: 18px; /* 能源管理按鈕下方間距 */
        }
        /* 此頁面沒有3D操控，隱藏不需要的按鈕和提示 */
        #ui-container, #controls-helper, #floor-indicator { display: none; }
       
        /* 移除標題連結的預設樣式 */
        #home-link-title {
            color: inherit; /* 繼承父元素(header)的文字顏色，也就是白色 */
            text-decoration: none; /* 移除底線 */
            position: absolute; /* ★ 1. 讓標題脫離文檔流，進行絕對定位 */
            left: 50%;          /* ★ 2. 將標題的左側邊緣，對齊到父容器的中心線 */
            top: 50%;           /* ★ 3. 將標題的頂部邊緣，對齊到父容器的中心線 */
            transform: translate(-50%, -50%); /* ★ 4. 將標題向左、向上移動自身寬高的一半，實現完美置中 */
            width: 60%; /* 設定一個寬度，防止標題在小螢幕上與兩側元素重疊 */
            text-align: center;
        }             
        /*icon*/
        .header-right-items {
            display: flex;
            align-items: center; /* 讓日期時間和圖示垂直置中對齊 */
            gap: 15px; /* 在日期時間和圖示之間增加間距 */
        }
        /* 2. 右上角 Logo 圖示的樣式 */
        #logo-icon-right {
            height: 32px; /* 設定圖示的高度 */
            width: 32px;  /* 設定圖示的寬度 */
        }
        /* 頁腳的樣式 */
        #page-footer {
            position: fixed; 
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1001; /* 確保它在最上層 (比側邊欄的 1000 還高) */
    
            color: rgba(255, 255, 255, 0.3); /* 半透明的白色文字 */
            font-size: 12px;
    
            /* 確保滑鼠可以穿透它，不會擋住下方的元素 */
            pointer-events: none; 
    
            /* 確保使用者無法選取文字 */
            user-select: none;
            -webkit-user-select: none;
        }
        /* --- ★★★ 全新的電梯儀表板樣式 ★★★ --- */
        #elevator-dashboard {
            position: absolute;
            top: 60px; /* 避開頂部橫幅 */
            left: 0;
            right: 0;
            bottom: 40px; /* 避開底部版權信息 */
            padding: clamp(10px, 2vw, 20px);  /* 響應式內邊距 */
            display: flex;
            justify-content: center;
            gap: clamp(15px, 3vw, 30px);  /* 響應式間距 */
            flex-wrap: wrap;
            overflow-y: auto;  /* 允許垂直滾動 */
        }
        
        /* 美化 elevator-dashboard 的滾動條樣式 */
        #elevator-dashboard::-webkit-scrollbar {
            width: 8px;
        }
        #elevator-dashboard::-webkit-scrollbar-track {
            background: transparent;
        }
        #elevator-dashboard::-webkit-scrollbar-thumb {
            background-color: #65a4ec;
            border-radius: 4px;
        }
        #elevator-dashboard::-webkit-scrollbar-thumb:hover {
            background-color: #c0c1c3;
        }
        #elevator-dashboard {
            scrollbar-width: thin;
            scrollbar-color: #65a4ec transparent;
        }
        /* --- 電梯儀表板樣式 --- */
        .elevator-unit {
            background-color: #161b22; border: 2px solid #30363d; border-radius: 8px;
            padding: 0; position: relative; 
            width: clamp(250px, 25vw, 280px);  /* 響應式寬度 */
            min-height: clamp(420px, 45vh, 480px);  /* 增加最小高度，確保有足夠空間 */
            perspective: 1000px;
        }
        .flipper {
            position: relative;
            width: 100%;
            height: calc(100% - 65px); 
            margin-top: 65px; 
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        /* 當 .elevator-unit 擁有 .flipped class 時，翻轉 .flipper */
        .elevator-unit.flipped .flipper {
            transform: rotateY(180deg);
        }
        .front, .back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            background-color: #161b22;
            border: none; /* 隱藏邊框以保持整體一致性 */
            border-radius: 0; /* 移除圓角 */
            padding: 10px;
            box-sizing: border-box;
        }
        .front {
            /* 正面內容：水平布局（樓層側 + 電梯側） */
            gap: 10px;
        }
        .back {
            /* 背面內容：垂直布局（進階功能），預先翻轉 180 度 */
            transform: rotateY(180deg);
            flex-direction: column;
            overflow: hidden; /* 確保內容不會溢出卡片邊界 */
            position: relative; /* 確保子元素的定位基準 */
            padding-top: 20px; /* 增加背面的上內邊距，往下移動5px */
        }
        /* 背面進階功能的樣式 */
        .advanced-controls {
            padding-top: 5px; /* 大幅減少上方間距 */
            display: flex;
            flex-direction: column;
            gap: 15px;
            height: 100%; /* 確保佔滿整個背面 */
            overflow: hidden; /* 防止內容溢出 */
            box-sizing: border-box; /* 包含內邊距在內 */
        }
        .adv-data-item {
            display: flex;
            justify-content: space-between;
            font-size: 15px;
            padding: 5px 0;
            border-bottom: 1px solid #21262d;
        }
        .adv-data-item .label { color: #8b949e; }
        .adv-data-item .value { font-weight: bold; }
        .adv-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .adv-btn {
            background-color: #21262d; border: 1px solid #30363d;
            color: #c9d1d9; padding: 10px; border-radius: 6px;
            cursor: pointer; transition: background-color 0.2s;
            /* 確保按鈕內的文字不會干擾點擊事件 */
            position: relative;
            z-index: 1;
        }
        .adv-btn:hover { background-color: #30363d; }
        .adv-btn * {
            /* 確保按鈕內所有子元素的點擊事件都傳遞給父按鈕 */
            pointer-events: none;
        }
        .manual-controls { 
            text-align: center; 
            display: flex;
            flex-direction: column;
            gap: 15px;  /* 增加兩組按鈕之間的間距 */
            padding: 0 10px; /* 左右內邊距，確保不碰到邊界 */
            box-sizing: border-box;
            max-width: 100%; /* 確保不超出父容器 */
            overflow: hidden; /* 防止溢出 */
        }
        .manual-controls-row {
            display: flex;
            justify-content: center;
            gap: clamp(5px, 2vw, 10px); /* 響應式間距 */
            flex-wrap: nowrap; /* 防止按鈕換行 */
        }
        .manual-controls button {
            font-size: clamp(16px, 3vw, 24px); /* 調整響應式字體大小 */
            width: clamp(35px, 7vw, 50px);     /* 調整響應式寬度 */
            height: clamp(35px, 7vw, 50px);    /* 調整響應式高度 */
            margin: 0;
            min-width: 35px;  /* 確保最小尺寸 */
            min-height: 35px;
            flex-shrink: 0; /* 防止按鈕被壓縮 */
        }
        .manual-controls .door-buttons {
            display: flex;
            justify-content: center;
            gap: clamp(5px, 2vw, 10px); /* 響應式間距 */
            margin-top: 10px;  /* 門控按鈕額外的上邊距 */
            flex-wrap: nowrap; /* 防止按鈕換行 */
        }
        .manual-controls .door-buttons button {
            font-size: clamp(10px, 2vw, 14px); /* 調整響應式字體大小 */
            width: clamp(45px, 8vw, 60px);     /* 調整響應式寬度 */
            height: clamp(28px, 5vw, 40px);    /* 調整響應式高度 */
            min-width: 45px;   /* 確保最小尺寸 */
            min-height: 28px;
            flex-shrink: 0; /* 防止按鈕被壓縮 */
        }
        
        /* 電梯標題 */
        .elevator-header {
            text-align: center;
            padding: 8px;
            font-weight: bold;
            color: white;
            position: absolute;
            top: 0; left: 0; right: 0;
            background-color: #21262d;
            border-top-left-radius: 6px;
            border-top-right-radius: 6px;
            border-bottom: 1px solid #30363d;
            font-size: 15px;
        }
        
        /* 樓層側 */
        .floors-side {
            flex: 1;
            display: flex;
            flex-direction: column-reverse;
            margin-top: 10px; /* 減少上邊距 */
            border-right: 1px solid #30363d;
            padding-right: clamp(4px, 1vw, 8px); /* 響應式內邊距 */
        }
        
        /* 車廂動畫側 */
        .elevator-side {
            flex: 0 0 clamp(60px, 15vw, 80px); /* 響應式寬度 */
            display: flex;
            flex-direction: column-reverse;
            margin-top: 10px; /* 減少上邊距 */
            position: relative;
            background-color: #0d1117;
            border-radius: 4px;
            border: 1px solid #21262d;
        }
        
        .floor {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 clamp(4px, 1.5vw, 8px); /* 響應式內邊距 */
            border-bottom: 1px dashed #30363d;
            transition: all 0.3s ease;
            min-height: clamp(25px, 6vh, 35px); /* 響應式最小高度 */
        }
        .floor:last-child { border-bottom: 1px dashed #30363d; }
        .floor-name { 
            font-size: clamp(12px, 3vw, 16px); /* 響應式字體大小 */
            font-weight: bold; 
            color: #d1d5d8; 
        }
        .hall-call-buttons button {
            background: none; border: none; color: #65717e;
            font-size: clamp(12px, 3vw, 16px); /* 響應式字體大小 */
            cursor: default;
        }
        .hall-call-buttons button.active { color: #f1c40f; }

        /* 車廂側樓層標示 */
        .shaft-floor {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            border-bottom: 1px solid #21262d;
            font-size: clamp(8px, 2vw, 12px); /* 響應式字體大小 */
            color: #6e7681;
            transition: all 0.3s ease;
            min-height: clamp(25px, 6vh, 35px); /* 響應式最小高度 */
        }
        .shaft-floor:last-child { border-bottom: 1px solid #21262d; }

        /* 電梯車廂 */
        .elevator-car {
            position: absolute;
            bottom: 0;
            left: 2px; right: 2px;
            height: 12.5%;
            background-color: #6e7681;
            border: 2px solid #c9d1d9;
            border-radius: 3px;
            box-sizing: border-box;
            transition: bottom 1s ease-in-out;
            z-index: 10;
            display: flex;
            overflow: hidden;
        }

        /* 車門 */
        .elevator-door {
            width: 50%;
            height: 100%;
            background-color: #adb5bd;
            border: 1px solid #8b949e;
            box-sizing: border-box;
            transition: transform 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(6px, 1.5vw, 8px); /* 響應式字體大小 */
            color: #495057;
        }
        
        .elevator-car.door-open .elevator-door.left { 
            transform: translateX(-100%); 
        }
        .elevator-car.door-open .elevator-door.right { 
            transform: translateX(100%); 
        }

        /* 車廂狀態顯示 */
        .car-status {
            position: absolute;
            top: 1px;
            left: 50%;
            transform: translateX(-50%);
            color: #212529;
            font-weight: bold;
            font-size: clamp(6px, 1.5vw, 8px); /* 響應式字體大小 */
            z-index: 11;
            background: rgba(255,255,255,0.9);
            padding: clamp(1px, 0.5vw, 2px); /* 響應式內邊距 */
            border-radius: 2px;
        }

        .shaft-floor.elevator-here {
            background-color: rgba(88, 166, 255, 0.3) !important;
            color: #58a6ff !important;
            font-weight: bold;
            box-shadow: inset 0 0 8px rgba(88, 166, 255, 0.5);
        }

        /* 車廂內叫車樓層顯示（改用藍色框） */
        .shaft-floor.car-call {
            background-color: rgba(88, 166, 255, 0.3) !important;
            color: #58a6ff !important;
            font-weight: bold;
            border: 1px solid #58a6ff;
            box-shadow: inset 0 0 8px rgba(88, 166, 255, 0.5);
        }

        /* ★★★ 狀態列樣式 ★★★ */
        .status-bar {
            position: absolute;
            top: 40px; /* 剛好在 header 下方 */
            left: 10px; right: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            z-index: 5;
        }
        
        /* 緊急呼叫按鈕樣式 */
        .emergency-call {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 6px 10px; /* 減少內邊距，讓按鈕更緊湊 */
            background-color: #21262d;
            border: 1px solid #30363d;
            border-radius: 4px;
            color: #8b949e;
            font-size: 12px; /* 稍微減少字體大小 */
            transition: all 0.3s ease;
            white-space: nowrap; /* 防止文字換行 */
            overflow: hidden; /* 隱藏溢出的文字 */
            text-overflow: ellipsis; /* 溢出時顯示省略號 */
            min-width: 0; /* 允許 flex 項目縮小 */
        }
        
        .emergency-call-light {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #404040;
            border: 1px solid #555;
            transition: all 0.3s ease;
        }
        
        .emergency-call.active {
            background-color: #2d1b1b;
            border-color: #e74c3c;
            color: #ff8a80;
            font-weight: bold;
            animation: pulse-red 1.5s infinite; /* ★ 將靜態陰影改為閃爍動畫 */
            cursor: pointer;
        }
        
        .emergency-call.active .emergency-call-light {
            background-color: #e74c3c;
            border-color: #ff6b6b;
            box-shadow: 0 0 6px #e74c3c, inset 0 0 6px #ff4444;
        }

        @keyframes pulse-red {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 79, 59, 0.71);
            }
            70% {
                box-shadow: 0 0 0 12px rgba(231, 77, 60, 0.15);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(231, 76, 60, 0);
                }
        }
        
        /* 運轉狀態按鈕樣式 */
        .run-status {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 6px 10px; /* 減少內邊距，讓按鈕更緊湊 */
            background-color: #21262d;
            border: 1px solid #30363d;
            border-radius: 4px;
            font-weight: bold;
            font-size: 12px; /* 稍微減少字體大小 */
            text-align: center;
            transition: all 0.3s ease;
            white-space: nowrap; /* 防止文字換行 */
            overflow: hidden; /* 隱藏溢出的文字 */
            text-overflow: ellipsis; /* 溢出時顯示省略號 */
            min-width: 0; /* 允許 flex 項目縮小 */
        }
        
        .run-status.fault { 
            background-color: #2d2519;
            border-color: #FFC107;
            color: #FFC107; 
            box-shadow: 0 0 6px rgba(255, 193, 7, 0.3);
        }
        
        .run-status.power-off { 
            background-color: #2d1b1b;
            border-color: #f5412d;
            color: #e74c3c; 
            box-shadow: 0 0 6px rgba(231, 76, 60, 0.3);
        }
        
        .run-status.standby { 
            background-color: #1f2329;
            border-color: #6b7280;
            color: #8b949e; 
        }
        
        .run-status.normal { 
            background-color: #1b2d1f;
            border-color: #2ecc71;
            color: #2ecc71; 
            box-shadow: 0 0 6px rgba(46, 204, 113, 0.3);
        }

        /* 調整樓層區塊的上邊距 */
        .floors-side, .elevator-side {
            margin-top: 10px; /* 設定適當的上邊距，避免與狀態列重疊 */
        }

        /* ★★★ Modal 樣式 ★★★ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background-color: #1e2328;  /* 改為稍微亮一點的深灰色 */
            border: 2px solid #58a6ff;  /* 改為藍色邊框 */
            border-radius: 8px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 4px 20px rgba(88, 166, 255, 0.3); /* 添加藍色光暈 */
        }
        
        .modal-content h3 {
            margin-top: 0;
            color: #58a6ff;  /* 改為藍色標題 */
            font-size: 20px;
            margin-bottom: 10px;
        }
        
        .modal-content p {
            color: #c9d1d9;  /* 改為更亮的白色文字 */
            margin-bottom: 20px;
        }
        
        .modal-content input[type="month"] {
            width: 100%;
            padding: 10px;
            background-color: #0d1117;  /* 更深的背景色 */
            border: 1px solid #58a6ff;  /* 藍色邊框 */
            border-radius: 6px;
            color: #c9d1d9;
            font-size: 16px;
            margin-bottom: 20px;
            text-align: center; /* 讓輸入內容置中 */
            box-sizing: border-box; /* 確保 width: 100% 包含 padding 和 border */
            color-scheme: dark; /* 使用深色主題 */
            accent-color: #58a6ff; /* 設定強調色為藍色 */
        }
        
        .modal-content input[type="month"]:focus {
            outline: none;
            border-color: #79c0ff;  /* 聚焦時更亮的藍色 */
            box-shadow: 0 0 0 2px rgba(88, 166, 255, 0.2);
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .modal-buttons .adv-btn {
            flex: 1;
            max-width: 120px;
            background-color: #21262d;
            border: 1px solid #58a6ff;  /* 藍色邊框 */
            color: #58a6ff;  /* 藍色文字 */
        }
        
        .modal-buttons .adv-btn:hover {
            background-color: rgba(88, 166, 255, 0.1);  /* 藍色半透明背景 */
            border-color: #79c0ff;  /* 更亮的藍色邊框 */
            color: #79c0ff;  /* 更亮的藍色文字 */
        }
        
        /* 匯出按鈕特殊樣式 */
        .modal-buttons #modal-export-btn {
            background-color: #238636;  /* 綠色背景 */
            border-color: #2ea043;  /* 綠色邊框 */
            color: #ffffff;  /* 白色文字 */
        }
        
        .modal-buttons #modal-export-btn:hover {
            background-color: #2ea043;  /* 更亮的綠色 */
            border-color: #46954a;
        }
        /* 設定按鈕的專屬樣式 */
        .settings-btn {
            position: absolute;
            top: 2px; /* 稍微增加與邊緣的距離 */
            right: 2px;
            z-index: 12;
    
            /* --- ★ 修改大小 --- */
            width: 30px;
            height: 30px;
            font-size: 20px; /* 齒輪圖示的大小 */

            /* --- ★修改顏色 --- */
            background-color: #52586068; /* 按鈕背景色 */
            color: #a9b0b9;            /* 齒輪的顏色 */
            border: 1px solid #484f58;

            /* 其他樣式 */
            padding: 0; /* 移除內邊距以讓圖示置中 */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .settings-btn:hover {
            background-color: #484f58;
            color: #c9d1d9;
        }

        /* ★★★ 緊急呼叫彈出視窗樣式 ★★★ */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(66, 64, 64, 0.498); display: flex;
            align-items: center; justify-content: center; z-index: 2000;
            opacity: 0; transition: opacity 0.3s ease; pointer-events: none;
        }
        .modal-overlay.visible { opacity: 1; pointer-events: auto; }
        .modal-content {
            background-color: #161b22b7; padding: 25px; border-radius: 8px;
            border: 1px solid #6b96c7; width: 480px;
            transform: scale(0.95); transition: transform 0.3s ease;
        }
        .modal-overlay.visible .modal-content { transform: scale(1); }
        .modal-content h3 { margin-top: 0; color: #ff8a80; }
        .video-placeholder {
            width: 100%;
            height: 270px;
            background-color: #0d1117;
            border: 1px solid #80889299;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #cad0d7;
            margin-bottom: 20px;
        }
        .modal-buttons { display: flex; justify-content: space-between; gap: 10px; margin-top: 20px; }
        .modal-buttons .adv-btn { flex: 1; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .modal-buttons .adv-btn svg { width: 18px; height: 18px; fill: currentColor; }
        .modal-buttons .adv-btn.resolve { background-color: #2ea043; border-color: #3fb950;color: white; }
        .modal-buttons .adv-btn.resolve:hover { background-color: #3fb950; }
        .modal-buttons .adv-btn.call {
            background-color: #4190ff; /* 深色背景 */
            border-color: #58a6ff;   /* 藍色邊框 */
            color: #ffffff;         /* 藍色文字和圖示 */
        }        
        .modal-buttons .adv-btn.call.active { background-color: #e74c3c; border-color: #ff6b6b; color: white; }

        /* ★★★ 響應式設計媒體查詢 ★★★ */
        @media (max-width: 768px) {
            .elevator-unit {
                width: clamp(200px, 45vw, 250px);
                min-height: clamp(300px, 35vh, 350px);
            }
            
            /* 調整正面卡片的樓層和車廂區域 */
            .floors-side {
                padding-right: 4px;
            }
            
            .elevator-side {
                flex: 0 0 clamp(50px, 12vw, 70px);
            }
            
            .floor {
                min-height: clamp(20px, 5vh, 30px);
                padding: 0 4px;
            }
            
            .floor-name {
                font-size: clamp(10px, 2.5vw, 14px);
            }
            
            .hall-call-buttons button {
                font-size: clamp(10px, 2.5vw, 14px);
            }
            
            .shaft-floor {
                min-height: clamp(20px, 5vh, 30px);
                font-size: clamp(6px, 1.5vw, 10px);
            }
            
            .car-status {
                font-size: clamp(5px, 1vw, 7px);
            }
            
            .elevator-door {
                font-size: clamp(5px, 1vw, 7px);
            }
            
            .manual-controls {
                padding: 0 5px; /* 減少內邊距 */
                gap: 10px; /* 減少間距 */
            }
            
            .manual-controls button {
                font-size: clamp(14px, 4vw, 18px);
                width: clamp(30px, 6vw, 40px);
                height: clamp(30px, 6vw, 40px);
                min-width: 30px;
                min-height: 30px;
            }
            
            .manual-controls .door-buttons button {
                font-size: clamp(9px, 2vw, 12px);
                width: clamp(40px, 9vw, 50px);
                height: clamp(25px, 5vw, 32px);
                min-width: 40px;
                min-height: 25px;
            }
            
            .manual-controls-row {
                gap: clamp(3px, 1vw, 8px);
            }
            
            .manual-controls .door-buttons {
                gap: clamp(3px, 1vw, 8px);
            }
            
            #elevator-dashboard {
                gap: clamp(10px, 2vw, 20px);
                padding: clamp(5px, 1vw, 15px);
            }
        }

        @media (max-width: 480px) {
            .elevator-unit {
                width: clamp(180px, 90vw, 220px);
                min-height: clamp(350px, 55vh, 400px); /* 在小螢幕上增加最小高度 */
            }
            
            .flipper {
                height: calc(100% - 65px); /* 在小螢幕上也進一步減少空間預留 */
                margin-top: 65px;
            }
            
            /* 進一步調整正面卡片的樓層和車廂區域 */
            .floors-side {
                padding-right: 3px;
                margin-top: 5px; /* 在小螢幕上減少上邊距 */
            }
            
            .elevator-side {
                flex: 0 0 clamp(40px, 10vw, 60px);
                margin-top: 5px; /* 在小螢幕上減少上邊距 */
            }
            
            .floor {
                min-height: clamp(18px, 4vh, 25px);
                padding: 0 3px;
            }
            
            .floor-name {
                font-size: clamp(8px, 2vw, 12px);
            }
            
            .hall-call-buttons button {
                font-size: clamp(8px, 2vw, 12px);
            }
            
            .shaft-floor {
                min-height: clamp(18px, 4vh, 25px);
                font-size: clamp(5px, 1vw, 8px);
            }
            
            .car-status {
                font-size: clamp(4px, 0.8vw, 6px);
                padding: 0.5px 1px;
            }
            
            .elevator-door {
                font-size: clamp(4px, 0.8vw, 6px);
            }
            
            .manual-controls {
                padding: 0 3px; /* 進一步減少內邊距 */
                gap: 8px;
            }
            
            .manual-controls button {
                font-size: clamp(12px, 3vw, 16px);
                width: clamp(28px, 5vw, 35px);
                height: clamp(28px, 5vw, 35px);
                min-width: 28px;
                min-height: 28px;
            }
            
            .manual-controls .door-buttons button {
                font-size: clamp(8px, 2vw, 10px);
                width: clamp(35px, 8vw, 45px);
                height: clamp(22px, 4vw, 28px);
                min-width: 35px;
                min-height: 22px;
            }
            
            .manual-controls-row {
                gap: 2px;
            }
            
            .manual-controls .door-buttons {
                gap: 2px;
            }
            
            /* 確保進階控制區域不會溢出 */
            .advanced-controls {
                padding: 15px 5px 10px 5px;
            }
        }
        /* ★★★ 語言選擇器樣式 ★★★ */      
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 50px;
            border-bottom: 1px solid #728aa2;
            padding-bottom: 10px;
        }
        #sidebar-menu h2 {
            color: white;
            margin: 0; /* 移除舊的邊距和邊框 */
            padding: 0;
            border: none;
            font-size: 18px; /* 預設字體大小 */
            white-space: nowrap; /* 防止換行 */
            overflow: hidden; /* 隱藏溢出內容 */
            text-overflow: ellipsis; /* 如果必要時顯示省略號 */
            transition: font-size 0.3s ease; /* 平滑的字體大小變化 */
        }
        
        /* 英語和日語的字體縮小設定 */
        html[lang="en"] #sidebar-menu h2,
        html[lang="ja"] #sidebar-menu h2 {
            font-size: 14px; /* 縮小字體以適應較長的文字 */
        }
        
        /* 額外的安全設定，針對特別長的文字 */
        #sidebar-menu h2[data-i18n="systemMenu"] {
            max-width: 150px; /* 限制最大寬度 */
            min-height: 20px; /* 確保有足夠的高度 */
        }
        
        #language-selector {
            width: auto; /* 讓寬度自適應內容 */
            background-color: #47637e;
            color: #ecf0f1;
            border: 1px solid #465a70;
            padding: 4px 8px; /* 縮小內邊距 */
            border-radius: 4px;
            font-size: 12px; /* 縮小字體 */
        }


    </style>
</head>
<body>
    <header id="top-banner">
        <button id="menu-toggle-btn" title="展開選單">☰</button>
        <a href="https://workkkkkkez00m.github.io/K-3D-viewer/index.html" id="home-link-title">
            <h1 id="project-title" data-i18n="projectTitle">智慧住宅中央監控系統 </h1>
        </a>
        <div class="header-right-items">
            <div id="datetime-container"></div>
            <img src="../assets/favicon-32x32.png" id="logo-icon-right" alt="系統圖示">
        </div>
    </header>

    <nav id="sidebar-menu">
        <button id="close-menu-btn">&times;</button>
        <div class="sidebar-header">
            <h2 data-i18n="systemMenu">系統選單</h2>
            <div class="language-selector-container">
                <select id="language-selector">
                    <option value="zh-TW">繁體中文</option>
                    <option value="en">English</option>
                    <option value="ja">日本語</option>
                    <option value="zh-CN">简体中文</option>
                </select>
            </div>
        </div>    
        <ul>            
            <li class="system-category">
                <a href="#" data-i18n="systemTheft">防盜及求救系統</a>
                <ul class="floor-submenu">
                    <li><a href="../theft_prevention/1f.html">1F</a></li>
                    <li><a href="../theft_prevention/2f.html">2F</a></li>
                    <li><a href="../theft_prevention/3f.html">3F</a></li>
                    <li><a href="../theft_prevention/4f.html">4F</a></li>
                    <li><a href="../theft_prevention/5f.html">5F</a></li>
                </ul>
            </li>
            <li class="system-category">
                <a href="#" data-i18n="systemCCTV">攝影監視系統</a>
                <ul class="floor-submenu">
                    <li><a href="../cctv/1f.html">1F</a></li>
                    <li><a href="../cctv/2f.html">2F</a></li>
                    <li><a href="../cctv/3f.html">3F</a></li>
                    <li><a href="../cctv/4f.html">4F</a></li>
                    <li><a href="../cctv/5f.html">5F</a></li>
                </ul>
            </li>
            <li class="system-category">
                <a href="#" data-i18n="systemAccess">門禁保全系統</a>
                <ul class="floor-submenu">
                     <li><a href="../access_control/1f.html">1F</a></li>
                    <li><a href="../access_control/2f.html">2F</a></li>
                    <li><a href="../access_control/3f.html">3F</a></li>
                    <li><a href="../access_control/4f.html">4F</a></li>
                    <li><a href="../access_control/5f.html">5F</a></li>
                </ul>
            </li>
            <li class="system-category">
                <a href="#" data-i18n="systemIntercom">影像對講系統</a>
                <ul class="floor-submenu">
                    <li><a href="../video_intercom/1f.html">1F</a></li>
                    <li><a href="../video_intercom/2f.html">2F</a></li>
                    <li><a href="../video_intercom/3f.html">3F</a></li>
                    <li><a href="../video_intercom/4f.html">4F</a></li>
                    <li><a href="../video_intercom/5f.html">5F</a></li>
                </ul>
            </li>
            <li class="system-category">
                <a href="#" data-i18n="systemFire">消防火警系統</a>
                <ul class="floor-submenu">
                    <li><a href="../fire_alarm/1f.html">1F</a></li>
                    <li><a href="../fire_alarm/2f.html">2F</a></li>
                    <li><a href="../fire_alarm/3f.html">3F</a></li>
                    <li><a href="../fire_alarm/4f.html">4F</a></li>
                    <li><a href="../fire_alarm/5f.html">5F</a></li>
                </ul>
            </li>
            <li class="system-category">
                <a href="#" data-i18n="systemPlumbing">給排水系統</a>
                <ul class="floor-submenu">
                   <li><a href="../plumbing_drainage/b3f.html">B3F</a></li>                   
                </ul>
            </li>
            <li class="system-category">
                <a href="#" data-i18n="systemParking">停車管理系統</a>
                <ul class="floor-submenu">
                    <li><a href="../parking_management/b1f.html">B1F</a></li>
                    <li><a href="../parking_management/b2f.html">B2F</a></li>
                    <li><a href="../parking_management/b3f.html">B3F</a></li>                   
                </ul>
            </li>   
            <li><a href="../energy/index.html" style="background-color: #007bff; font-weight: bold;" data-i18n="dashboardEnergy">能源管理儀表板</a></li>            
            <li><a href="../elevator_management/index.html" style="background-color: #007bff; font-weight: bold;" data-i18n="dashboardElevator">電梯監控系統</a></li>
            <li><a id="back-to-home-btn" href="..K-3D-viewer/index.html" data-i18n="backToHome">‹ 回首頁</a></li>
        </ul>  
    </nav>

    <main id="content-wrapper">
        <div id="elevator-dashboard">
        </div>    
    </main>
    <!-- 紀錄匯出 Modal -->
    <div id="export-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modal-title">匯出電梯紀錄</h3>
            <p id="modal-subtitle"></p>
            <input type="month" id="month-picker">
            <div class="modal-buttons">
                <button id="modal-cancel-btn" class="adv-btn">取消</button>
                <button id="modal-export-btn" class="adv-btn">匯出</button>
            </div>
        </div>
    </div>
    <!-- ★ 新增：緊急呼叫 Modal -->
    <div id="emergency-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="emergency-modal-title" data-i18n="emergencyModalTitle">緊急呼叫處理</h3>
            <div class="video-placeholder" data-i18n="videoConnecting">影像連線中...</div>
            <div class="modal-buttons">
                <button id="modal-resolve-btn" class="adv-btn resolve" data-i18n="resolveIncident">事件解除</button>
                <button id="modal-call-btn" class="adv-btn call">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 14q-1.25 0-2.125-.875T9 11V5q0-1.25.875-2.125T12 2q1.25 0 2.125.875T15 5v6q0 1.25-.875 2.125T12 14Zm-1 7v-3.075q-2.6-.35-4.3-2.325T4 11H6q0 2.075 1.463 3.538T11 16v-2h2v2q2.075-.537 3.538-1.962T18 11h2q0 2.925-1.7 4.9T14 17.925V21Z"/></svg>
                    <span data-i18n="liveCall">即時通話</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ★★★ 多國語言功能 ★★★
            const translations = {
                'zh-TW': {
                    pageTitleElevator: '電梯監控系統',
                    projectTitle: '智慧住宅中央監控系統',
                    systemMenu: '系統選單',
                    dashboardEnergy: '能源管理儀表板',
                    dashboardElevator: '電梯監控系統',
                    systemTheft: '防盜及求救系統',
                    systemCCTV: '攝影監視系統',
                    systemAccess: '門禁保全系統',
                    systemIntercom: '影像對講系統',
                    systemFire: '消防火警系統',
                    systemPlumbing: '給排水系統',
                    systemParking: '停車管理系統',
                    backToHome: '‹ 回首頁',
                    emergencyCall: '緊急呼叫',
                    runStatus: '運轉狀態',
                    // 緊急呼叫彈出視窗翻譯
                    emergencyModalTitle: '緊急呼叫處理',
                    videoConnecting: '影像連線中...',
                    resolveIncident: '事件解除',
                    liveCall: '即時通話',
                    resolving: '解除中...',
                    resolveFailed: '解除失敗',
                    resolveFailedMsg: '解除失敗，請查看主控台錯誤訊息。',
                    // 電梯名稱翻譯
                    elevator1: '1號昇降梯',
                    elevator2: '2號昇降梯',
                    elevator3: '3號無障礙昇降梯',
                    elevator4: '4號無障礙昇降梯',
                    elevator5: '5號緊急昇降梯',
                    advHeader: '進階功能',
                    advCarFloor: '車廂樓層',
                    advDoorStatus: '電梯門狀態',
                    advRunTime: '本日運轉時間',
                    advStartupCount: '本日啟動次數',
                    exportRecords: '紀錄匯出',
                    exportLog: '紀錄匯出',
                    manualMode: '手動模式',
                    closeManualMode: '關閉手動',
                    manualUp: '▲',
                    manualStop: '■',
                    manualDown: '▼',
                    manualOpen: '開門',
                    manualClose: '關門',
                    // 動態狀態文字
                    statusNormal: '自動運轉',
                    statusStandby: '自動休止',
                    statusPowerOff: '停電運轉',
                    statusFault: '電梯故障',
                    statusManual: '手動運轉',
                    statusPowerOutageStop: '停電停止',
                    doorOpen: '開啟',
                    doorClosed: '關閉',
                    // 時間和計數單位翻譯
                    unitMinute: '分鐘',
                    unitTimes: '次'
                },
                'en': {
                    pageTitleElevator: 'Elevator Monitoring System',
                    projectTitle: 'Smart Housing Central Monitoring System',
                    systemMenu: 'System Menu',
                    dashboardEnergy: 'Energy Dashboard',
                    dashboardElevator: 'Elevator Monitoring',
                    systemTheft: 'Security System',
                    systemCCTV: 'CCTV System',
                    systemAccess: 'Access Control',
                    systemIntercom: 'Video Intercom',
                    systemFire: 'Fire Alarm System',
                    systemPlumbing: 'Plumbing System',
                    systemParking: 'Parking System',
                    backToHome: '‹ Back to Home',
                    emergencyCall: 'Emergency Call',
                    runStatus: 'Run Status',
                    // 緊急呼叫彈出視窗翻譯
                    emergencyModalTitle: 'Emergency Call Handling',
                    videoConnecting: 'Video connecting...',
                    resolveIncident: 'Resolve Incident',
                    liveCall: 'Live Call',
                    resolving: 'Resolving...',
                    resolveFailed: 'Resolution Failed',
                    resolveFailedMsg: 'Resolution failed, please check console for error details.',
                    // 電梯名稱翻譯
                    elevator1: 'Elevator No.1',
                    elevator2: 'Elevator No.2',
                    elevator3: 'Elevator No.3 (Accessible)',
                    elevator4: 'Elevator No.4 (Accessible)',
                    elevator5: 'Elevator No.5 (Emergency)',
                    advHeader: 'Advanced',
                    advCarFloor: 'Car Floor',
                    advDoorStatus: 'Door Status',
                    advRunTime: 'Runtime Today',
                    advStartupCount: 'Starts Today',
                    exportRecords: 'Export Log',
                    exportLog: 'Export Log',
                    manualMode: 'Manual Mode',
                    closeManualMode: 'Exit Manual',
                    manualUp: '▲',
                    manualStop: '■',
                    manualDown: '▼',
                    manualOpen: 'Open',
                    manualClose: 'Close',
                    statusNormal: 'Auto',
                    statusStandby: 'Standby',
                    statusPowerOff: 'Power Outage',
                    statusFault: 'Fault',
                    statusManual: 'Manual',
                    statusPowerOutageStop: 'Power Stop',
                    doorOpen: 'Open',
                    doorClosed: 'Closed',
                    // 時間和計數單位翻譯
                    unitMinute: 'min',
                    unitTimes: 'times'
                },
                'ja': {
                    pageTitleElevator: 'エレベーター監視システム',
                    projectTitle: 'スマート住宅中央監視システム',
                    systemMenu: 'システムメニュー',
                    dashboardEnergy: 'エネルギー管理',
                    dashboardElevator: 'エレベーター監視',
                    systemTheft: '防犯システム',
                    systemCCTV: '監視カメラ',
                    systemAccess: 'アクセス制御',
                    systemIntercom: 'ビデオインターホン',
                    systemFire: '火災警報',
                    systemPlumbing: '給排水システム',
                    systemParking: '駐車場管理',
                    backToHome: '‹ ホームに戻る',
                    emergencyCall: '緊急呼び出し',
                    runStatus: '運転状態',
                    // 緊急呼叫彈出視窗翻譯
                    emergencyModalTitle: '緊急呼び出し対応',
                    videoConnecting: '映像接続中...',
                    resolveIncident: '事案解除',
                    liveCall: 'ライブ通話',
                    resolving: '解除中...',
                    resolveFailed: '解除失敗',
                    resolveFailedMsg: '解除に失敗しました。コンソールのエラー詳細をご確認ください。',
                    // 電梯名稱翻譯
                    elevator1: '1号エレベーター',
                    elevator2: '2号エレベーター',
                    elevator3: '3号エレベーター（バリアフリー）',
                    elevator4: '4号エレベーター（バリアフリー）',
                    elevator5: '5号エレベーター（緊急用）',
                    advHeader: '詳細機能',
                    advCarFloor: '現在階',
                    advDoorStatus: 'ドア状態',
                    advRunTime: '本日の稼働時間',
                    advStartupCount: '本日の起動回数',
                    exportRecords: 'ログ出力',
                    exportLog: 'ログ出力',
                    manualMode: '手動モード',
                    closeManualMode: '手動解除',
                    manualUp: '▲',
                    manualStop: '■',
                    manualDown: '▼',
                    manualOpen: '開',
                    manualClose: '閉',
                    statusNormal: '自動運転',
                    statusStandby: '自動休止',
                    statusPowerOff: '停電運転',
                    statusFault: '故障',
                    statusManual: '手動運転',
                    statusPowerOutageStop: '停電停止',
                    doorOpen: '開',
                    doorClosed: '閉',
                    // 時間和計數單位翻譯
                    unitMinute: '分',
                    unitTimes: '回'
                },
                'zh-CN': {
                    pageTitleElevator: '电梯监控系统',
                    projectTitle: '智慧住宅中央监控系统',
                    systemMenu: '系统菜单',
                    dashboardEnergy: '能源管理仪表板',
                    dashboardElevator: '电梯监控系统',
                    systemTheft: '防盗及求救系统',
                    systemCCTV: '摄影监控系统',
                    systemAccess: '门禁保全系统',
                    systemIntercom: '影像对讲系统',
                    systemFire: '消防火警系统',
                    systemPlumbing: '给排水系统',
                    systemParking: '停车管理系统',
                    backToHome: '‹ 返回首页',
                    emergencyCall: '紧急呼叫',
                    runStatus: '运转状态',
                    // 緊急呼叫彈出視窗翻譯
                    emergencyModalTitle: '紧急呼叫处理',
                    videoConnecting: '影像连线中...',
                    resolveIncident: '事件解除',
                    liveCall: '实时通话',
                    resolving: '解除中...',
                    resolveFailed: '解除失败',
                    resolveFailedMsg: '解除失败，请查看控制台错误信息。',
                    // 電梯名稱翻譯
                    elevator1: '一号电梯',
                    elevator2: '二号电梯',
                    elevator3: '三号无障碍电梯',
                    elevator4: '四号无障碍电梯',
                    elevator5: '五号紧急电梯',
                    advHeader: '进阶功能',
                    advCarFloor: '轿厢楼层',
                    advDoorStatus: '电梯门状态',
                    advRunTime: '本日运转时间',
                    advStartupCount: '本日启动次数',
                    exportRecords: '记录导出',
                    exportLog: '记录导出',
                    manualMode: '手动模式',
                    closeManualMode: '关闭手动',
                    manualUp: '▲',
                    manualStop: '■',
                    manualDown: '▼',
                    manualOpen: '开门',
                    manualClose: '关门',
                    statusNormal: '自动运转',
                    statusStandby: '自动休止',
                    statusPowerOff: '停电运转',
                    statusFault: '电梯故障',
                    statusManual: '手动运转',
                    statusPowerOutageStop: '停电停止',
                    doorOpen: '开启',
                    doorClosed: '关闭',
                    // 時間和計數單位翻譯
                    unitMinute: '分钟',
                    unitTimes: '次'
                }
            };
            
            let currentLanguage = 'zh-TW';

            function setLanguage(lang) {
                currentLanguage = lang;
                localStorage.setItem('preferredLanguage', lang);
                
                // 0. 更新HTML的lang屬性，以便CSS語言選擇器能正常工作
                document.documentElement.setAttribute('lang', lang);
                
                // 1. 翻譯所有靜態標籤
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (translations[lang] && translations[lang][key]) {
                        el.textContent = translations[lang][key];
                    }
                });
                
                // 2. 動態調整側邊欄標題字體大小
                adjustSidebarTitleFontSize();
                
                // 3. 觸發一次數據更新，來翻譯所有動態內容
                updateElevatorStatus();
            }

            function adjustSidebarTitleFontSize() {
                const sidebarTitle = document.querySelector('#sidebar-menu h2');
                if (!sidebarTitle) return;
                
                // 重置字體大小為預設值
                sidebarTitle.style.fontSize = '';
                
                // 檢查文字是否溢出
                const containerWidth = sidebarTitle.parentElement.offsetWidth - 120; // 減去語言選擇器的空間
                const textWidth = sidebarTitle.scrollWidth;
                
                if (textWidth > containerWidth) {
                    // 如果文字溢出，縮小字體
                    sidebarTitle.style.fontSize = '14px';
                    
                    // 如果還是溢出，進一步縮小
                    if (sidebarTitle.scrollWidth > containerWidth) {
                        sidebarTitle.style.fontSize = '12px';
                    }
                }
            }

            function initI18n() {
                const languageSelector = document.getElementById('language-selector');
                const savedLang = localStorage.getItem('preferredLanguage');
                if (savedLang && translations[savedLang]) {
                    languageSelector.value = savedLang;
                    setLanguage(savedLang);
                } else {
                    setLanguage('zh-TW');
                }
                languageSelector.addEventListener('change', (e) => {
                    setLanguage(e.target.value);
                });
            }
            // --- 全局樓層列表定義（從低樓層到高樓層） ---
            const allFloors = ['B3F', 'B2F', 'B1F', '1F', '2F', '3F', '4F', '5F'];
            
            // --- 獲取基本 DOM 元素 ---
            const datetimeContainer = document.getElementById('datetime-container');
            const menuToggleBtn = document.getElementById('menu-toggle-btn');
            const sidebarMenu = document.getElementById('sidebar-menu');
            const closeMenuBtn = document.getElementById('close-menu-btn');
            const dashboard = document.getElementById('elevator-dashboard');
            const exportModal = document.getElementById('export-modal');
            const modalSubtitle = document.getElementById('modal-subtitle');
            const monthPicker = document.getElementById('month-picker');
            const modalCancelBtn = document.getElementById('modal-cancel-btn');
            const modalExportBtn = document.getElementById('modal-export-btn');
            const emergencyModal = document.getElementById('emergency-modal');
            const emergencyModalTitle = document.getElementById('emergency-modal-title');
            const modalResolveBtn = document.getElementById('modal-resolve-btn');
            const modalCallBtn = document.getElementById('modal-call-btn');
            let currentExportElevator = null;
            let currentEmergencyElevator = null;

            // --- UI 框架功能函式 ---
            function updateDateTime() {
                const now = new Date();
                const dateOptions = { year: 'numeric', month: '2-digit', day: '2-digit', weekday: 'long' };
                const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };
                datetimeContainer.textContent = `${now.toLocaleDateString('zh-TW', dateOptions)} ${now.toLocaleTimeString('zh-TW', timeOptions)}`;
            }

            function setupSidebarMenu() {
                menuToggleBtn.addEventListener('click', () => sidebarMenu.classList.toggle('open'));
                closeMenuBtn.addEventListener('click', () => sidebarMenu.classList.remove('open'));
                document.addEventListener('click', (event) => {
                    const isClickInsideMenu = sidebarMenu.contains(event.target) || menuToggleBtn.contains(event.target);
                    if (sidebarMenu.classList.contains('open') && !isClickInsideMenu) {
                        sidebarMenu.classList.remove('open');
                    }
                });
                document.querySelectorAll('.system-category > a').forEach(categoryLink => {
                    const submenu = categoryLink.nextElementSibling;
                    if (submenu && submenu.classList.contains('floor-submenu')) {
                        categoryLink.addEventListener('click', (event) => {
                            event.preventDefault();
                            categoryLink.parentElement.classList.toggle('active');
                            submenu.style.maxHeight = submenu.style.maxHeight ? null : submenu.scrollHeight + "px";
                        });
                    }
                });
            }

            async function updateElevatorStatus() {
            try {
                const response = await fetch('http://localhost:3000/api/elevators');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const elevatorsData = await response.json();
                
                // ★ 第一次載入時，記錄API回應結構
                if (dashboard.children.length === 0) {
                    console.log('=== API 回應結構分析 ===');
                    console.log('電梯數據:', elevatorsData);
                    if (elevatorsData.length > 0) {
                        console.log('第一部電梯的完整數據結構:', elevatorsData[0]);
                        console.log('可用的屬性:', Object.keys(elevatorsData[0]));
                    }
                    console.log('=== 分析完畢 ===');
                    
                    createElevatorUI(elevatorsData);
                }

                elevatorsData.forEach(data => {
                    const unit = document.getElementById(`elevator-unit-${data.id}`);
                    if (!unit) return;
                    
                    // 檢查是否處於手動模式
                    const isManualMode = unit.dataset.manualMode === 'true';
                    
                    // 樓層側和電梯側現在在 .front 容器內
                    const frontContainer = unit.querySelector('.front');
                    const floorsSide = frontContainer.querySelector('.floors-side');
                    const elevatorSide = frontContainer.querySelector('.elevator-side');
                    
                    if (!floorsSide || !elevatorSide) return;
                    
                    const car = elevatorSide.querySelector('.elevator-car');
                    const carStatus = elevatorSide.querySelector('.car-status');

                    // 獲取背面卡片的數據元素
                    const advCarFloor = unit.querySelector('.adv-car-floor');
                    const advDoorStatus = unit.querySelector('.adv-door-status');
                    const advRunTime = unit.querySelector('.adv-run-time');
                    const advStartupCount = unit.querySelector('.adv-startup-count');
                    
                    // ★★★ 計算電梯位置 ★★★
                    const currentGlobalIndex = allFloors.indexOf(data.currentFloor);
                    const floorHeightPercentage = 100 / allFloors.length;

                    // 1. 更新電梯車廂位置
                    car.style.bottom = `${currentGlobalIndex * floorHeightPercentage}%`;
                    car.style.height = `${floorHeightPercentage}%`;

                    // 2. 更新車廂狀態顯示
                    let directionText = '';
                    if(data.direction === 'up') directionText = '▲';
                    if(data.direction === 'down') directionText = '▼';
                    carStatus.textContent = `${data.currentFloor} ${directionText}`;

                    // 3. 更新車門狀態
                    car.classList.toggle('door-open', data.doorStatus === 'open');

                    // 4. 清除所有樓層的電梯效果
                    floorsSide.querySelectorAll('.floor').forEach(floor => {
                        floor.classList.remove('elevator-here');
                    });
                    elevatorSide.querySelectorAll('.shaft-floor').forEach(floor => {
                        floor.classList.remove('elevator-here', 'car-call');
                    });

                    // 5. 顯示車廂內叫車樓層（電梯井右側藍色框）
                    if (data.carCalls && data.carCalls.length > 0) {
                        data.carCalls.forEach(callFloor => {
                            const shaftFloorEl = elevatorSide.querySelector(`[data-floor-name="${callFloor}"]`);
                            if (shaftFloorEl && callFloor !== data.currentFloor) {
                                shaftFloorEl.classList.add('car-call');
                            }
                        });
                    }

                    // 6. 更新樓層叫車燈（大廳叫車）
                    floorsSide.querySelectorAll('.hall-call-buttons button').forEach(btn => btn.classList.remove('active'));
                    data.hallCalls.forEach(call => {
                        const floorEl = floorsSide.querySelector(`[data-floor-name="${call.floor}"]`);
                        if(floorEl) {
                            const btn = floorEl.querySelector(`[data-direction="${call.direction}"]`);
                            if(btn) btn.classList.add('active');
                        }
                    });

                    // ★ 更新背面卡片的數據（使用多語言翻譯）
                    advCarFloor.textContent = data.currentFloor;
                    const doorStatusKey = data.doorStatus === 'open' ? 'doorOpen' : 'doorClosed';
                    advDoorStatus.textContent = translations[currentLanguage] ? translations[currentLanguage][doorStatusKey] : (data.doorStatus === 'open' ? '開啟' : '關閉');
                    
                    // 使用多語言翻譯的時間和計數單位
                    const minuteUnit = translations[currentLanguage] ? translations[currentLanguage]['unitMinute'] : '分鐘';
                    const timesUnit = translations[currentLanguage] ? translations[currentLanguage]['unitTimes'] : '次';
                    advRunTime.textContent = `${data.runTime} ${minuteUnit}`;
                    advStartupCount.textContent = `${data.startupCount} ${timesUnit}`;

                    // ★★★ 更新狀態列 ★★★
                    const emergencyCallEl = unit.querySelector('.emergency-call');
                    const runStatusEl = unit.querySelector('.run-status');
                    
                    // 緊急呼叫狀態不受手動模式影響
                    emergencyCallEl.classList.toggle('active', data.emergencyCall);
                    
                    // 只有在非手動模式時才更新運轉狀態
                    if (!isManualMode) {
                        // 根據當前語言翻譯運轉狀態
                        let statusText = data.runStatus;
                        if (translations[currentLanguage]) {
                            if (data.runStatus === '電梯故障') statusText = translations[currentLanguage]['statusFault'];
                            else if (data.runStatus === '停電運轉') statusText = translations[currentLanguage]['statusPowerOff'];
                            else if (data.runStatus === '自動休止') statusText = translations[currentLanguage]['statusStandby'];
                            else if (data.runStatus === '自動運轉') statusText = translations[currentLanguage]['statusNormal'];
                        }
                        
                        runStatusEl.textContent = statusText;
                        runStatusEl.className = 'run-status'; // 先重置 class
                        runStatusEl.style.backgroundColor = '';
                        runStatusEl.style.borderColor = '';
                        runStatusEl.style.color = '';
                        runStatusEl.style.boxShadow = '';
                        
                        if (data.runStatus === '電梯故障') runStatusEl.classList.add('fault');
                        // 只有五號電梯（緊急電梯）才會有停電運轉狀態
                        if (data.runStatus === '停電運轉' && data.id === 5) runStatusEl.classList.add('power-off');
                        if (data.runStatus === '自動休止') runStatusEl.classList.add('standby');
                        if (data.runStatus === '自動運轉') runStatusEl.classList.add('normal');
                    }

                });

            } catch (error) {
                console.error("更新電梯狀態失敗:", error);
                // 顯示詳細錯誤信息到儀表板
                if (dashboard.children.length === 0) {
                    dashboard.innerHTML = `
                        <div style="color: #ff6b6b; text-align: center; padding: 50px; font-size: 18px;">
                            無法連接到電梯 API 伺服器<br>
                            <small>請確認 API 服務正在運行</small><br><br>
                            <div style="background-color: #2d1b1b; border: 1px solid #e74c3c; border-radius: 6px; padding: 15px; margin-top: 20px; font-size: 12px; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto;">
                                <strong>錯誤詳情：</strong><br>
                                ${error.message}<br><br>
                                <strong>可能的解決方案：</strong><br>
                                1. 確認 API 服務器是否在 localhost:3000 運行<br>
                                2. 檢查網路連接<br>
                                3. 確認 CORS 設定是否正確<br>
                                4. 查看瀏覽器開發者工具的 Network 標籤
                            </div>
                        </div>
                    `;
                }
            }
        }
        
        // 第一次建立電梯 UI 的函式
        function createElevatorUI(elevatorsData) {
            dashboard.innerHTML = '';
            elevatorsData.forEach(data => {
                // 創建電梯單元容器
                const elevatorUnit = document.createElement('div');
                elevatorUnit.className = 'elevator-unit';
                elevatorUnit.id = `elevator-unit-${data.id}`;

                // 建立樓層信息和車廂側標示
                let floorsHTML = '';
                let shaftFloorsHTML = '';
                allFloors.forEach(floorName => {
                    if (data.serviceFloors.includes(floorName)) {
                        // 樓層信息側
                        floorsHTML += `
                            <div class="floor" data-floor-name="${floorName}">
                                <span class="floor-name">${floorName}</span>
                                <div class="hall-call-buttons">
                                    ${floorName !== '5F' ? `<button data-direction="up">▲</button>` : '<span></span>'}
                                    ${floorName !== 'B3F' ? `<button data-direction="down">▼</button>` : '<span></span>'}
                                </div>
                            </div>
                        `;
                        // 車廂側樓層標示
                        shaftFloorsHTML += `<div class="shaft-floor" data-floor-name="${floorName}">${floorName}</div>`;
                    } else {
                        floorsHTML += `<div class="floor" style="background-color: transparent;"></div>`;
                        shaftFloorsHTML += `<div class="shaft-floor"></div>`;
                    }
                });

                // 設置完整的電梯HTML結構
                elevatorUnit.innerHTML = `
                    <div class="elevator-header" data-i18n="elevator${data.id}">${data.name}</div>
                    <div class="status-bar">
                        <div class="emergency-call">
                            <div class="emergency-call-light"></div>
                            <span data-i18n="emergencyCall">緊急呼叫</span>
                        </div>
                        <div class="run-status"></div>
                    </div>
                    <div class="flipper">
                        <div class="front">
                            <div class="floors-side">
                                ${floorsHTML}
                            </div>
                            <div class="elevator-side">
                                ${shaftFloorsHTML}
                                <div class="elevator-car">
                                    <div class="car-status"></div>
                                    <div class="elevator-door left">◀</div>
                                    <div class="elevator-door right">▶</div>
                                </div>
                            </div>
                        </div>
                        <div class="back">
                            <div class="advanced-controls">
                                <div class="adv-data-item">
                                    <span class="label" data-i18n="advCarFloor">車廂樓層</span>
                                    <span class="value adv-car-floor">--</span>
                                </div>
                                <div class="adv-data-item">
                                    <span class="label" data-i18n="advDoorStatus">電梯門狀態</span>
                                    <span class="value adv-door-status">--</span>
                                </div>
                                <div class="adv-data-item">
                                    <span class="label" data-i18n="advRunTime">本日運轉時間</span>
                                    <span class="value adv-run-time">--</span>
                                </div>
                                <div class="adv-data-item">
                                    <span class="label" data-i18n="advStartupCount">本日啟動次數</span>
                                    <span class="value adv-startup-count">--</span>
                                </div>
                                <div class="adv-buttons">
                                    <button class="adv-btn" data-i18n="exportRecords">紀錄匯出</button>
                                    <button class="adv-btn manual-toggle" data-i18n="manualMode">手動模式</button>
                                </div>
                                <div class="manual-controls" style="display: none;">
                                    <div class="manual-controls-row">
                                        <button class="adv-btn manual-up" data-i18n="manualUp">▲</button>
                                        <button class="adv-btn manual-stop" data-i18n="manualStop">■</button>
                                        <button class="adv-btn manual-down" data-i18n="manualDown">▼</button>
                                    </div>
                                    <div class="door-buttons">
                                        <button class="adv-btn manual-open" data-i18n="manualOpen">開門</button>
                                        <button class="adv-btn manual-close" data-i18n="manualClose">關門</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="adv-btn settings-btn">⚙️</button>
                `;
                
                // ★ 為緊急呼叫按鈕新增事件
                const emergencyCallBtn = elevatorUnit.querySelector('.emergency-call');
                emergencyCallBtn.addEventListener('click', () => {
                    // 只有在處於 active 狀態時才能點擊
                    if (emergencyCallBtn.classList.contains('active')) {
                        openEmergencyModal(data);
                    }
                });

                // 為設定按鈕新增翻轉事件
                elevatorUnit.querySelector('.settings-btn').addEventListener('click', () => {
                    elevatorUnit.classList.toggle('flipped');
                });
                
                // ★ 為紀錄匯出按鈕新增事件
                const exportBtn = elevatorUnit.querySelector('.adv-buttons button:first-child');
                exportBtn.addEventListener('click', () => {
                    openExportModal(data);
                });

                // 為手動模式按鈕添加切換功能
                const manualToggleBtn = elevatorUnit.querySelector('.manual-toggle');
                const manualControls = elevatorUnit.querySelector('.manual-controls');
                
                manualToggleBtn.addEventListener('click', async () => {
                    const isVisible = manualControls.style.display !== 'none';
                    const willBeManualMode = !isVisible;
                    
                    // 先禁用按鈕，防止重複點擊（使用多語言文字）
                    manualToggleBtn.disabled = true;
                    const switchingText = willBeManualMode ? '切換中...' : '關閉中...';
                    manualToggleBtn.textContent = switchingText;
                    
                    try {
                        // 調用後端 API 切換手動模式
                        console.log(`切換手動模式: 電梯 ${data.id}, 目標模式: ${willBeManualMode ? '手動' : '自動'}`);
                        
                        const response = await fetch(`http://localhost:3000/api/elevators/${data.id}/toggle-manual`, { 
                            method: 'POST',
                            headers: { 
                                'Content-Type': 'application/json',
                                'Accept': 'application/json'
                            }
                        });
                        
                        console.log(`手動模式切換回應狀態: ${response.status}`);
                        
                        if (!response.ok) {
                            const errorText = await response.text();
                            throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
                        }
                        
                        const updatedData = await response.json();
                        console.log('手動模式切換回應:', updatedData);
                        
                        // 根據後端回應更新前端狀態
                        const actualManualMode = updatedData.manualMode;
                        elevatorUnit.dataset.manualMode = actualManualMode;
                        
                        // 更新 UI 顯示
                        manualControls.style.display = actualManualMode ? 'block' : 'none';
                        manualToggleBtn.style.backgroundColor = actualManualMode ? '#2d1b2d' : '#21262d';
                        manualToggleBtn.style.borderColor = actualManualMode ? '#8b5cf6' : '#30363d';
                        manualToggleBtn.style.color = actualManualMode ? '#c084fc' : '#c9d1d9';
                        
                        // 更新運轉狀態顯示（使用多語言翻譯）
                        const runStatusEl = elevatorUnit.querySelector('.run-status');
                        if (actualManualMode) {
                            const manualStatusText = translations[currentLanguage] ? translations[currentLanguage]['statusManual'] : '手動運轉';
                            runStatusEl.textContent = manualStatusText;
                            runStatusEl.className = 'run-status';
                            runStatusEl.style.backgroundColor = '#2d1b2d';
                            runStatusEl.style.borderColor = '#8b5cf6';
                            runStatusEl.style.color = '#c084fc';
                            runStatusEl.style.boxShadow = '0 0 6px rgba(139, 92, 246, 0.3)';
                        }
                        // 如果關閉手動模式，狀態會在下次API更新時恢復
                        
                    } catch (error) {
                        console.error("切換手動模式失敗:", error);
                        alert(`切換手動模式失敗: ${error.message}`);
                        
                        // 發生錯誤時保持原狀態
                        elevatorUnit.dataset.manualMode = isVisible;
                    } finally {
                        // 恢復按鈕狀態（使用多語言翻譯）
                        const finalManualMode = elevatorUnit.dataset.manualMode === 'true';
                        const manualModeText = translations[currentLanguage] ? translations[currentLanguage]['manualMode'] : '手動模式';
                        const closeManualModeText = translations[currentLanguage] ? translations[currentLanguage]['closeManualMode'] : '關閉手動';
                        manualToggleBtn.textContent = finalManualMode ? closeManualModeText : manualModeText;
                        manualToggleBtn.disabled = false;
                    }
                });

                // ★ 為手動控制按鈕添加事件監聽器
                const upBtn = manualControls.querySelector('.manual-up');
                const stopBtn = manualControls.querySelector('.manual-stop');
                const downBtn = manualControls.querySelector('.manual-down');

                if (upBtn) {
                    upBtn.addEventListener('click', async () => {
                        upBtn.style.backgroundColor = '#58a6ff';
                        await sendManualCommand(data.id, 'up');
                        setTimeout(() => {
                            upBtn.style.backgroundColor = '';
                        }, 500);
                    });
                }
                
                if (stopBtn) {
                    stopBtn.addEventListener('click', async () => {
                        stopBtn.style.backgroundColor = '#e74c3c';
                        await sendManualCommand(data.id, 'stop');
                        setTimeout(() => {
                            stopBtn.style.backgroundColor = '';
                        }, 500);
                    });
                }
                
                if (downBtn) {
                    downBtn.addEventListener('click', async () => {
                        downBtn.style.backgroundColor = '#58a6ff';
                        await sendManualCommand(data.id, 'down');
                        setTimeout(() => {
                            downBtn.style.backgroundColor = '';
                        }, 500);
                    });
                }

                const openBtn = elevatorUnit.querySelector('.manual-open');
                const closeBtn = elevatorUnit.querySelector('.manual-close');
                
                if (openBtn) {
                    openBtn.addEventListener('click', async () => {
                        openBtn.style.backgroundColor = '#27ae60';
                        await sendManualCommand(data.id, 'open');
                        setTimeout(() => {
                            openBtn.style.backgroundColor = '';
                        }, 500);
                    });
                }
                
                if (closeBtn) {
                    closeBtn.addEventListener('click', async () => {
                        closeBtn.style.backgroundColor = '#e67e22';
                        await sendManualCommand(data.id, 'close');
                        setTimeout(() => {
                            closeBtn.style.backgroundColor = '';
                        }, 500);
                    });
                }

                // 添加到儀表板
                dashboard.appendChild(elevatorUnit);
            });
            
            // 對新創建的電梯UI元素應用當前語言設定
            setLanguage(currentLanguage);
        }

        async function sendManualCommand(elevatorId, command) {
            try {
                console.log(`發送手動指令: 電梯 ${elevatorId}, 指令: ${command}`);
                
                const response = await fetch(`http://localhost:3000/api/elevators/${elevatorId}/manual-command`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ command: command })
                });
                
                console.log(`手動指令回應狀態: ${response.status}`);
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('手動指令回應:', result);
                
                // 立即觸發一次更新，以獲得即時反饋
                updateElevatorStatus();
                
            } catch (error) {
                console.error(`發送手動指令 ${command} 失敗:`, error);
                alert(`手動控制失敗: ${error.message}`);
            }
        }

        // ★★★ 緊急呼叫相關函式 ★★★
        function openEmergencyModal(elevatorData) {
            currentEmergencyElevator = elevatorData;
            const titleText = translations[currentLanguage] ? translations[currentLanguage]['emergencyModalTitle'] : '緊急呼叫處理';
            const elevatorName = translations[currentLanguage] ? translations[currentLanguage][`elevator${elevatorData.id}`] : elevatorData.name;
            emergencyModalTitle.textContent = `${titleText} - ${elevatorName}`;
            emergencyModal.classList.add('visible');
        }

        function closeEmergencyModal() {
            emergencyModal.classList.remove('visible');
            modalCallBtn.classList.remove('active'); // 關閉時重置通話按鈕
            currentEmergencyElevator = null;
        }

        async function handleResolveEmergency() {
            if (!currentEmergencyElevator) return;

            const resolvingText = translations[currentLanguage] ? translations[currentLanguage]['resolving'] : '解除中...';
            const resolveFailedText = translations[currentLanguage] ? translations[currentLanguage]['resolveFailed'] : '解除失敗';
            const resolveFailedMsgText = translations[currentLanguage] ? translations[currentLanguage]['resolveFailedMsg'] : '解除失敗，請查看主控台錯誤訊息。';
            const resolveIncidentText = translations[currentLanguage] ? translations[currentLanguage]['resolveIncident'] : '事件解除';

            modalResolveBtn.textContent = resolvingText;
            modalResolveBtn.disabled = true;

            try {
                const response = await fetch(`http://localhost:3000/api/elevators/${currentEmergencyElevator.id}/resolve-emergency`, {
                    method: 'POST',
                });
                if (!response.ok) {
                    throw new Error(resolveFailedText);
                }
                // 立即更新前端狀態，提供即時反饋
                updateElevatorStatus();
            } catch (error) {
                console.error("解除緊急呼叫失敗:", error);
                alert(resolveFailedMsgText);
            } finally {
                modalResolveBtn.textContent = resolveIncidentText;
                modalResolveBtn.disabled = false;
                closeEmergencyModal();
            }
        }

        // ★★★ 紀錄匯出相關函式 ★★★
        function openExportModal(elevatorData) {
            currentExportElevator = elevatorData;
            modalSubtitle.textContent = `正在為 ${elevatorData.name} 選擇匯出月份`;
            
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            monthPicker.value = `${year}-${month}`;
            
            exportModal.classList.add('visible');
        }

        function closeExportModal() {
            exportModal.classList.remove('visible');
            currentExportElevator = null;
        }

        async function handleExport() {
            if (!currentExportElevator) return;

            const [year, month] = monthPicker.value.split('-');
            const elevatorId = currentExportElevator.id;
            
            modalExportBtn.textContent = '正在產生...';
            modalExportBtn.disabled = true;

            try {
                console.log(`正在請求報告數據: year=${year}, month=${month}, elevatorId=${elevatorId}`);
                const response = await fetch(`http://localhost:3000/api/elevators/report?year=${year}&month=${month}&elevatorId=${elevatorId}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}, statusText: ${response.statusText}`);
                }
                
                const reportData = await response.json();
                console.log('收到報告數據:', reportData);

                // 檢查數據結構
                if (!reportData.dailySummaries || !reportData.eventLogs) {
                    throw new Error('報告數據格式不正確');
                }

                const wb = XLSX.utils.book_new();
                const summaryWS = XLSX.utils.json_to_sheet(reportData.dailySummaries);
                const logWS = XLSX.utils.json_to_sheet(reportData.eventLogs);

                XLSX.utils.book_append_sheet(wb, summaryWS, "每日摘要");
                XLSX.utils.book_append_sheet(wb, logWS, "事件紀錄");

                XLSX.writeFile(wb, `${currentExportElevator.name}_${year}-${month}_營運報告.xlsx`);
                
                console.log('Excel 文件已成功生成');
            } catch (error) {
                console.error("匯出報告失敗:", error);
                let errorMessage = "產生報告失敗";
                
                if (error.message.includes('HTTP error')) {
                    errorMessage = "API 服務器錯誤，請檢查服務器狀態";
                } else if (error.message.includes('Failed to fetch')) {
                    errorMessage = "無法連接到 API 服務器";
                } else if (error.message.includes('報告數據格式不正確')) {
                    errorMessage = "服務器返回的數據格式有誤";
                }
                
                alert(`${errorMessage}\n\n詳細錯誤：${error.message}`);
            } finally {
                modalExportBtn.textContent = '匯出';
                modalExportBtn.disabled = false;
                closeExportModal();
            }
        }

        // --- 事件監聽 ---
        modalCancelBtn.addEventListener('click', closeExportModal);
        modalExportBtn.addEventListener('click', handleExport);
        modalResolveBtn.addEventListener('click', handleResolveEmergency);
        modalCallBtn.addEventListener('click', () => {
            modalCallBtn.classList.toggle('active');
        });

            // --- 啟動基本功能 ---
            initI18n(); // 初始化多語言功能
            updateDateTime();
            setInterval(updateDateTime, 1000);
            setupSidebarMenu();
            updateElevatorStatus();
            setInterval(updateElevatorStatus, 2000);
        });
    </script>
    <footer id="page-footer">
        <span>v1.2.6</span> | <span>Copyright © 2025 KL </span>
    </footer>
</body>
</html>